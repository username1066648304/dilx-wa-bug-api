<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UltraXweb</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --main: #4CAF50;
      --second: #2E7D32;
      --bg: #0a0a0a;
      --text: #f2f2f2;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      position: relative;
    }

    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(10, 10, 10, 0.9);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
      border-bottom: 1px solid var(--main);
    }

    .logo {
      font-size: 1.2rem;
      font-weight: bold;
      color: var(--main);
    }

    .logo span {
      color: #F1222;
      font-weight: normal;
    }

    /* Hamburger Menu */
    .hamburger {
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .hamburger-line {
      width: 25px;
      height: 3px;
      background-color: var(--main);
      transition: all 0.3s;
    }

    /* Side Menu */
    .side-menu {
      position: fixed;
      top: 0;
      left: -300px;
      width: 250px;
      height: 100%;
      background: rgba(10, 10, 10, 0.95);
      border-right: 1px solid var(--main);
      z-index: 999;
      padding: 70px 20px 20px;
      transition: all 0.3s;
      overflow-y: auto;
    }

    .side-menu.active {
      left: 0;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 998;
      display: none;
    }

    .menu-overlay.active {
      display: block;
    }

    .menu-item {
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 5px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .menu-item:hover {
      background: rgba(76, 175, 80, 0.1);
    }

    .menu-item i {
      width: 20px;
      text-align: center;
    }

    /* Main Content */
    .main-content {
      padding: 80px 20px 20px;
      max-width: 800px;
      margin: 0 auto;
    }

    .card {
      background: rgba(76, 175, 80, 0.03);
      border: 1px solid rgba(76, 175, 80, 0.2);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }

    .card h2 {
      color: var(--main);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Form Styles */
    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #aaa;
    }

    .form-control {
      background: rgba(255, 255, 255, 0.05);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 10px;
      width: 100%;
    }

    .btn {
      padding: 10px 15px;
      border-radius: 8px;
      border: none;
      background: var(--main);
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn:hover {
      background: var(--second);
    }

    .btn-telegram {
      background: #0088cc;
      margin-top: 15px;
      width: 100%;
      justify-content: center;
    }

    .btn-telegram:hover {
      background: #0077b3;
    }

    /* Dashboard Info */
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .info-item {
      background: rgba(76, 175, 80, 0.05);
      border: 1px solid rgba(76, 175, 80, 0.1);
      border-radius: 8px;
      padding: 15px;
    }

    .info-label {
      color: #aaa;
      font-size: 0.9rem;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 1.1rem;
    }

    /* User List Table */
    .user-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    .user-table th, .user-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid rgba(76, 175, 80, 0.2);
    }

    .user-table th {
      color: var(--main);
    }

    /* Hidden class */
    .hidden {
      display: none;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.3s forwards;
    }

    /* Loading spinner */
    .spinner {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Header with Hamburger (hidden on login screen) -->
  <div class="header hidden" id="header">
    <div class="hamburger" id="hamburger">
      <div class="hamburger-line"></div>
      <div class="hamburger-line"></div>
      <div class="hamburger-line"></div>
    </div>
    <div class="logo">UltraXweb <span>@F1222</span></div>
    <div></div> <!-- Spacer -->
  </div>

  <!-- Side Menu -->
  <div class="side-menu" id="sideMenu">
    <!-- Menu items will be populated by JavaScript -->
  </div>
  <div class="menu-overlay" id="menuOverlay"></div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Login Form -->
    <div class="card" id="loginCard">
      <h2 style="text-align: center;"><i class="fas fa-sign-in-alt"></i> Login</h2>
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="username" class="form-control">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="password" class="form-control">
      </div>
      <button class="btn" onclick="login()" id="loginBtn">
        <i class="fas fa-sign-in-alt"></i> Login
      </button>
      
      <!-- Buy Access via Telegram Button -->
      <a href="https://t.me/dilxVXII" target="_blank" class="btn btn-telegram">
        <i class="fab fa-telegram"></i> Buy Access via Telegram
      </a>
      
      <div id="loginResult" style="margin-top: 15px; text-align: center;"></div>
    </div>

    <!-- Dashboard -->
    <div class="card hidden" id="dashboard">
      <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">Username</div>
          <div class="info-value" id="infoUsername">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">Role</div>
          <div class="info-value" id="infoRole">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">Device ID</div>
          <div class="info-value" id="infoDeviceId">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">Expired</div>
          <div class="info-value" id="infoExpired">-</div>
        </div>
      </div>
    </div>

    <!-- My Info -->
    <div class="card hidden fade-in" id="myInfo">
      <h2><i class="fas fa-user"></i> My Info</h2>
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="myInfoUsername" class="form-control" readonly>
      </div>
      <div class="form-group">
        <label>Role</label>
        <input type="text" id="myInfoRole" class="form-control" readonly>
      </div>
      <div class="form-group">
        <label>Reset Password</label>
        <input type="password" id="newPassword" class="form-control" placeholder="New password">
      </div>
      <button class="btn" onclick="resetPassword()" id="resetPassBtn">
        <i class="fas fa-key"></i> Reset Password
      </button>
      <button class="btn" onclick="hideAllMenus()" style="margin-left: 10px;">
        <i class="fas fa-times"></i> Close
      </button>
      <div id="myInfoResult" style="margin-top: 15px;"></div>
    </div>

    <!-- Admin: Create User -->
    <div class="card hidden fade-in" id="adminCreateUser">
      <h2><i class="fas fa-user-plus"></i> Create User</h2>
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="newUsername" class="form-control">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="newUserPassword" class="form-control">
      </div>
      <div class="form-group">
        <label>Role</label>
        <select id="newUserRole" class="form-control">
          <option value="admin">Admin</option>
          <option value="reseller">Reseller</option>
          <option value="user" selected>User</option>
        </select>
      </div>
      <div class="form-group">
        <label>Expiration Days</label>
        <input type="number" id="newUserDays" class="form-control" min="1" value="30">
      </div>
      <button class="btn" onclick="createUser()" id="createUserBtn">
        <i class="fas fa-save"></i> Create User
      </button>
      <button class="btn" onclick="hideAllMenus()" style="margin-left: 10px;">
        <i class="fas fa-times"></i> Close
      </button>
      <div id="createUserResult" style="margin-top: 15px;"></div>
    </div>

    <!-- Admin: List Users -->
    <div class="card hidden fade-in" id="adminListUsers">
      <h2><i class="fas fa-users"></i> User List</h2>
      <div style="overflow-x: auto;">
        <table class="user-table">
          <thead>
            <tr>
              <th>Username</th>
              <th>Role</th>
              <th>Expired</th>
              <th>Device ID</th>
            </tr>
          </thead>
          <tbody id="userListBody">
            <!-- Users will be populated here -->
          </tbody>
        </table>
      </div>
      <button class="btn" onclick="hideAllMenus()" style="margin-top: 15px;">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>

  <script>
    // JSONBin configuration
    const BIN_ID = "688384cdae596e708fbb97e4"; // Replace with your actual bin ID
    const API_KEY = "$2a$10$55IAjRl7i3QlilxdTPmqx.5/Idiemz453V9zHKc76Z9q4jDPhvL.C"; // Replace with your actual API key
    const headers = {
      "Content-Type": "application/json",
      "X-Master-Key": API_KEY
    };

    // Global variables
    let currentUser = null;
    let localDeviceId = localStorage.getItem('device_id');
    if (!localDeviceId) {
      localDeviceId = generateDeviceId();
      localStorage.setItem('device_id', localDeviceId);
    }

    // Generate device ID
    function generateDeviceId() {
      return Math.random().toString(36).substring(2, 15);
    }

    // DOM elements
    const header = document.getElementById('header');
    const hamburger = document.getElementById('hamburger');
    const sideMenu = document.getElementById('sideMenu');
    const menuOverlay = document.getElementById('menuOverlay');
    const loginCard = document.getElementById('loginCard');
    const dashboard = document.getElementById('dashboard');

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Check if user is already logged in
      const user = JSON.parse(localStorage.getItem('currentUser'));
      if (user) {
        currentUser = user;
        showDashboard();
      }

      // Hamburger menu click event
      hamburger.addEventListener('click', toggleMenu);
      menuOverlay.addEventListener('click', toggleMenu);
    });

    // Toggle side menu
    function toggleMenu() {
      sideMenu.classList.toggle('active');
      menuOverlay.classList.toggle('active');
    }

    // Hide all menu cards
    function hideAllMenus() {
      document.querySelectorAll('.card').forEach(card => {
        if (!card.id.includes('loginCard') && !card.id.includes('dashboard')) {
          card.classList.add('hidden');
        }
      });
      toggleMenu();
    }

    // Show specific menu card
    function showMenu(menuId) {
      hideAllMenus();
      document.getElementById(menuId).classList.remove('hidden');
      
      // If showing user list, load users
      if (menuId === 'adminListUsers') {
        loadUserList();
      }
    }

    // Update side menu based on user role
    function updateSideMenu() {
      sideMenu.innerHTML = '';
      
      if (!currentUser) return;

      // Common menu items
      const menuItems = [];
      
      menuItems.push(
        { icon: 'fa-user', text: 'My Info', action: () => showMenu('myInfo') }
      );

      if (currentUser.role === 'admin') {
        menuItems.push(
          { icon: 'fa-user-plus', text: 'Create User', action: () => showMenu('adminCreateUser') },
          { icon: 'fa-users', text: 'List Users', action: () => showMenu('adminListUsers') }
        );
      }

      // Add menu items to side menu
      menuItems.forEach(item => {
        const menuItem = document.createElement('div');
        menuItem.className = 'menu-item';
        menuItem.innerHTML = `<i class="fas ${item.icon}"></i> ${item.text}`;
        menuItem.addEventListener('click', item.action);
        sideMenu.appendChild(menuItem);
      });

      // Add logout button
      const logoutItem = document.createElement('div');
      logoutItem.className = 'menu-item';
      logoutItem.innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
      logoutItem.addEventListener('click', logout);
      logoutItem.style.marginTop = '20px';
      logoutItem.style.color = '#f44336';
      sideMenu.appendChild(logoutItem);
    }

    // Get users from JSONBin
    async function getUsers() {
      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers });
        const data = await response.json();
        return data.record;
      } catch (error) {
        console.error('Error fetching users:', error);
        return [];
      }
    }

    // Update users in JSONBin
    async function updateUsers(users) {
      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
          method: 'PUT',
          headers,
          body: JSON.stringify(users)
        });
        return await response.json();
      } catch (error) {
        console.error('Error updating users:', error);
        return null;
      }
    }

    // Login function
    async function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const loginResult = document.getElementById('loginResult');
      const loginBtn = document.getElementById('loginBtn');

      if (!username || !password) {
        loginResult.innerHTML = 'Please enter username and password';
        loginResult.style.color = '#f44336';
        return;
      }

      // Show loading state
      loginBtn.innerHTML = '<i class="fas fa-spinner spinner"></i> Logging in...';
      loginBtn.disabled = true;

      try {
        const users = await getUsers();
        const user = users.find(u => u.username === username && u.password === password);

        if (!user) {
          loginResult.innerHTML = 'Invalid username or password';
          loginResult.style.color = '#f44336';
          return;
        }

        // Check if account is already in use on another device
        if (user.device_id && user.device_id !== localDeviceId) {
          loginResult.innerHTML = 'Account is already in use on another device';
          loginResult.style.color = '#f44336';
          return;
        }

        // Update user device ID
        user.device_id = localDeviceId;
        const updatedUsers = users.map(u => u.username === user.username ? user : u);
        await updateUsers(updatedUsers);

        currentUser = user;
        localStorage.setItem('currentUser', JSON.stringify(user));
        showDashboard();
      } catch (error) {
        loginResult.innerHTML = 'Login failed: ' + error.message;
        loginResult.style.color = '#f44336';
      } finally {
        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
        loginBtn.disabled = false;
      }
    }

    // Show dashboard
    function showDashboard() {
      // Show header and hide login
      header.classList.remove('hidden');
      loginCard.classList.add('hidden');
      dashboard.classList.remove('hidden');
      
      // Update dashboard info
      document.getElementById('infoUsername').textContent = currentUser.username;
      document.getElementById('infoRole').textContent = currentUser.role;
      document.getElementById('infoDeviceId').textContent = localDeviceId;
      document.getElementById('infoExpired').textContent = currentUser.expired || 'N/A';
      
      // Update My Info
      document.getElementById('myInfoUsername').value = currentUser.username;
      document.getElementById('myInfoRole').value = currentUser.role;
      
      updateSideMenu();
    }

    // Logout function
    async function logout() {
      try {
        if (currentUser) {
          const users = await getUsers();
          const updatedUsers = users.map(u => {
            if (u.username === currentUser.username) {
              return { ...u, device_id: '' };
            }
            return u;
          });
          await updateUsers(updatedUsers);
        }
      } catch (error) {
        console.error('Error during logout:', error);
      } finally {
        currentUser = null;
        localStorage.removeItem('currentUser');
        header.classList.add('hidden');
        loginCard.classList.remove('hidden');
        dashboard.classList.add('hidden');
        hideAllMenus();
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
      }
    }

    // Reset password
    async function resetPassword() {
      const newPassword = document.getElementById('newPassword').value;
      const resetPassBtn = document.getElementById('resetPassBtn');
      const myInfoResult = document.getElementById('myInfoResult');

      if (!newPassword) {
        myInfoResult.innerHTML = 'Please enter new password';
        myInfoResult.style.color = '#f44336';
        return;
      }

      // Show loading state
      resetPassBtn.innerHTML = '<i class="fas fa-spinner spinner"></i> Updating...';
      resetPassBtn.disabled = true;

      try {
        const users = await getUsers();
        const updatedUsers = users.map(u => {
          if (u.username === currentUser.username) {
            return { ...u, password: newPassword };
          }
          return u;
        });

        await updateUsers(updatedUsers);

        // Update current user
        currentUser.password = newPassword;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));

        myInfoResult.innerHTML = 'Password updated successfully';
        myInfoResult.style.color = 'var(--main)';
        document.getElementById('newPassword').value = '';
      } catch (error) {
        myInfoResult.innerHTML = 'Error updating password: ' + error.message;
        myInfoResult.style.color = '#f44336';
      } finally {
        resetPassBtn.innerHTML = '<i class="fas fa-key"></i> Reset Password';
        resetPassBtn.disabled = false;
      }
    }

    // Create new user (admin only)
    async function createUser() {
      const username = document.getElementById('newUsername').value;
      const password = document.getElementById('newUserPassword').value;
      const role = document.getElementById('newUserRole').value;
      const days = parseInt(document.getElementById('newUserDays').value);
      const createUserBtn = document.getElementById('createUserBtn');
      const createUserResult = document.getElementById('createUserResult');

      if (!username || !password || isNaN(days)) {
        createUserResult.innerHTML = 'Please fill all fields correctly';
        createUserResult.style.color = '#f44336';
        return;
      }

      // Show loading state
      createUserBtn.innerHTML = '<i class="fas fa-spinner spinner"></i> Creating...';
      createUserBtn.disabled = true;

      try {
        const users = await getUsers();
        
        // Check if username already exists
        if (users.some(u => u.username === username)) {
          createUserResult.innerHTML = 'Username already exists';
          createUserResult.style.color = '#f44336';
          return;
        }

        // Calculate expiration date
        const expiredDate = new Date();
        expiredDate.setDate(expiredDate.getDate() + days);

        const newUser = {
          username,
          password,
          role,
          telegram_id: null,
          device_id: '',
          expired: expiredDate.toISOString().split('T')[0]
        };

        const updatedUsers = [...users, newUser];
        await updateUsers(updatedUsers);

        createUserResult.innerHTML = `User ${username} created successfully`;
        createUserResult.style.color = 'var(--main)';
        
        // Clear form
        document.getElementById('newUsername').value = '';
        document.getElementById('newUserPassword').value = '';
        document.getElementById('newUserDays').value = '30';
      } catch (error) {
        createUserResult.innerHTML = 'Error creating user: ' + error.message;
        createUserResult.style.color = '#f44336';
      } finally {
        createUserBtn.innerHTML = '<i class="fas fa-save"></i> Create User';
        createUserBtn.disabled = false;
      }
    }

    // Load user list for admin
    async function loadUserList() {
      const userListBody = document.getElementById('userListBody');
      userListBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">Loading users...</td></tr>';

      try {
        const users = await getUsers();
        
        if (users.length === 0) {
          userListBody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No users found</td></tr>';
          return;
        }

        userListBody.innerHTML = '';
        users.forEach(user => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${user.username}</td>
            <td>${user.role}</td>
            <td>${user.expired || 'N/A'}</td>
            <td>${user.device_id || 'Not logged in'}</td>
          `;
          userListBody.appendChild(row);
        });
      } catch (error) {
        userListBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #f44336;">Error loading users</td></tr>';
      }
    }
  </script>
</body>
</html>